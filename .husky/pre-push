#!/bin/sh

# Ensure bun is in PATH (for git hooks which may have limited PATH)
export PATH="$HOME/.bun/bin:$HOME/.local/bin:/usr/local/bin:$PATH"

# Check if bun version matches package.json
EXPECTED_VERSION=$(grep '"packageManager"' package.json | sed 's/.*"bun@\([^"]*\)".*/\1/')
CURRENT_VERSION=$(bun --version 2>/dev/null || echo "not-found")
if [ "$CURRENT_VERSION" = "not-found" ]; then
  echo "Warning: bun not found in PATH, skipping version check"
elif [ "$CURRENT_VERSION" != "$EXPECTED_VERSION" ]; then
  echo "Error: Bun version $CURRENT_VERSION does not match expected version $EXPECTED_VERSION from package.json"
  exit 1
fi
bun typecheck
